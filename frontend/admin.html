<!doctype html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Admin - Vite & Gourmand</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"></head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark sticky-top" style="background:rgba(0,0,0,.6)">
<div class="container"><a class="navbar-brand fw-bold" href="/">Vite &amp; Gourmand</a>
<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="nav">
<ul class="navbar-nav ms-auto gap-2">
<li class="nav-item"><a class="nav-link" href="/menus.html">Menus</a></li>
<li class="nav-item"><a class="nav-link" href="/contact.html">Contact</a></li>
<li class="nav-item"><a class="nav-link" href="/dashboard.html">Espace</a></li>
<li class="nav-item"><a class="nav-link" href="/login.html" id="navLogin">Connexion</a></li>
<li class="nav-item"><button class="btn btn-sm btn-outline-light" id="navLogout" style="display:none">Déconnexion</button></li>
</ul></div></div></nav>
<main class="container py-4">
<h1 class="h4">Espace Admin</h1>
<div class="row g-3">
  <div class="col-lg-4"><div class="card p-3">
    <h2 class="h6">Créer employé</h2>
    <label class="form-label">Email</label><input id="email" class="form-control" type="email">
    <label class="form-label mt-2">Mot de passe</label><input id="pw" class="form-control" type="password">
    <button class="btn btn-vg w-100 mt-3" id="create">Créer</button>
    <div id="msg" class="mt-2" aria-live="polite"></div>
  </div></div>
  <div class="col-lg-8"><div class="card p-3">
    <h2 class="h6">Stats (Mongo)</h2>
    <div id="stats" class="d-grid gap-2" aria-live="polite"></div>
  </div></div>
</div>
</main>
<footer class="py-4" style="border-top:1px solid #2a2d33"><div class="container d-flex flex-column flex-md-row justify-content-between gap-3">
<div><div class="fw-bold">Horaires</div><div>Lun–Dim : 09:00–19:00</div></div>
<div class="d-flex gap-3"><a href="/legal.html">Mentions légales</a><a href="/cgv.html">CGV</a></div></div></footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script type="module">import{getUser,clearSession}from"/js/api.js";const u=getUser();const l=document.getElementById("navLogin");const o=document.getElementById("navLogout");
if(u){l.style.display="none";o.style.display="inline-block"};o?.addEventListener("click",()=>{clearSession();location.href="/"});</script>

<script type="module">
import { api, getUser, requireLogin } from "/js/api.js";
if(!requireLogin()) {}
const u=getUser(); if(u.role!=="admin") location.href="/dashboard.html";
async function load(){
  const r=await api("/api/admin/stats/menus");
  stats.innerHTML=r.items.map(x=>`<div class="card p-2"><div class="fw-semibold">Menu #${x.menuId} • ${x.month}</div>
  <div class="small text-secondary">Commandes: ${x.ordersCount} • CA: ${Number(x.revenue).toFixed(2)} €</div></div>`).join("")||'<div class="text-secondary">Aucune stat.</div>';
}
create.addEventListener("click", async ()=>{
  msg.textContent="";
  try{ await api("/api/admin/employees",{method:"POST",body:{email:email.value.trim(),password:pw.value}});
    msg.innerHTML='<div class="text-success">Employé créé.</div>';
  }catch(e){ msg.innerHTML=`<div class="text-danger">${e.message}</div>`; }
});
await load();
</script>
</body></html>